<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>test</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <script src="build/browser.js"></script>
    <script src="capture.js"></script>

    <script src="//mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script src="jszip.min.js"></script>
    <script src="FileSaver.min.js"></script>
  </head>
  <body>
    <h1>Capture Page</h1>

    <br />
    <br />
    <br />

    Place File Here â†’<input type="file" id="input" multiple />

    <div id="hold" style="position: relative"></div>

    <script>
      const inputElement = document.getElementById("input");

      var pdfjsLib = window["pdfjs-dist/build/pdf"];

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "//mozilla.github.io/pdf.js/build/pdf.worker.js";

      window.numberfinished = 0;

      // https://stackoverflow.com/questions/22048395/how-to-open-a-local-pdf-in-pdfjs-using-file-input/28567893
      inputElement.onchange = function (event) {
        var zip = new JSZip();

        for (let i = 0; i < event.target.files.length; i++) {
          prepareFile(
            event.target.files[i],
            zip,
            document.getElementById("hold")
          );
        }

        function sleep(ms) {
          return new Promise((resolve) => setTimeout(resolve, ms));
        }

        (async () => {
          while (window.numberfinished < event.target.files.length) {
            console.clear();
            console.log("waiting...");
            console.log(window.numberfinished);
            sleep(5000);
          }
          zip.generateAsync({ type: "blob" }).then(function (content) {
            // see FileSaver.js
            saveAs(content, "Result.zip");
          });
        })();
      };
    </script>
  </body>
</html>
